<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Remote configuration · DataCurator Documentation</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="index.html"><img src="assets/logo.png" alt="DataCurator Documentation logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">DataCurator Documentation</a></span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Index</a></li><li><a class="tocitem" href="installation.html">Installation</a></li><li><a class="tocitem" href="usage.html">Quikstart</a></li><li><a class="tocitem" href="recipe.html">Documented recipe with all features demonstrated</a></li><li><a class="tocitem" href="conditions.html">Conditions and Actions for use in recipes</a></li><li class="is-active"><a class="tocitem" href="remote.html">Remote configuration</a><ul class="internal"><li><a class="tocitem" href="#Requirements"><span>Requirements</span></a></li><li><a class="tocitem" href="#Slack"><span>Slack</span></a></li><li><a class="tocitem" href="#Owncloud"><span>Owncloud</span></a></li><li><a class="tocitem" href="#SCP"><span>SCP</span></a></li><li><a class="tocitem" href="#Triggering-remote-scripts"><span>Triggering remote scripts</span></a></li><li><a class="tocitem" href="#Remote-execution-of-DataCurator"><span>Remote execution of DataCurator</span></a></li><li><a class="tocitem" href="#Singularity"><span>Singularity</span></a></li><li><a class="tocitem" href="#Notes"><span>Notes</span></a></li></ul></li><li><a class="tocitem" href="extending.html">Using Python or R code</a></li><li><a class="tocitem" href="reference.html">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="remote.html">Remote configuration</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="remote.html">Remote configuration</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/bencardoen/DataCurator.jl/blob/main/docs/src/remote.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Remote-support"><a class="docs-heading-anchor" href="#Remote-support">Remote support</a><a id="Remote-support-1"></a><a class="docs-heading-anchor-permalink" href="#Remote-support" title="Permalink"></a></h1><h2 id="Requirements"><a class="docs-heading-anchor" href="#Requirements">Requirements</a><a id="Requirements-1"></a><a class="docs-heading-anchor-permalink" href="#Requirements" title="Permalink"></a></h2><div class="admonition is-info"><header class="admonition-header">If you wish to use the remote capabilities (Owncloud, Slack, SCP), you need [curl](https://curl.se/download.html), [scp, and ssh](https://www.openssh.com/) installed and configured</header><div class="admonition-body"></div></div><h2 id="Slack"><a class="docs-heading-anchor" href="#Slack">Slack</a><a id="Slack-1"></a><a class="docs-heading-anchor-permalink" href="#Slack" title="Permalink"></a></h2><h3 id="Configuration"><a class="docs-heading-anchor" href="#Configuration">Configuration</a><a id="Configuration-1"></a><a class="docs-heading-anchor-permalink" href="#Configuration" title="Permalink"></a></h3><p>To use Slack support, you need a Slack Workspace where you have configured an endpoint. Navigate to:</p><ul><li>Workspace settings</li><li>Manage Apps</li><li>Build</li><li>Go through the configuration<ul><li>Select a name and target workspace</li><li>Incoming Webhooks<ul><li>Set to On<ul><li>Add New Webhook<ul><li>Select channel to use</li><li>Copy the hook and save it in a file</li></ul></li></ul></li></ul></li></ul></li></ul><p>Endpoint.txt:</p><pre><code class="language-bash hljs">https://hooks.slack.com/services/xxxxx/yyyy</code></pre><p>Test that it works</p><pre><code class="language-bash hljs">curl -X POST -H &#39;Content-type: application/json&#39; --data &#39;{&quot;text&quot;:&quot;Hello, World!&quot;}&#39; https://hooks.slack.com/services/xxx/yyyyyy</code></pre><p>Where <code>x</code> and <code>y</code> are secret strings to be used to send messages, unique to your installation. You can test if it works in DataCurator</p><pre><code class="language-julia hljs">using DataCurator
using SlurmMonitor
ep = &quot;endpoint.txt&quot;
e = SlurmMonitor.readendpoint(ep)
if !isnothing(e)
  SlurmMonitor.posttoslack(&quot;Test&quot;, e)
else
  @warn &quot;Failed&quot;
end</code></pre><h3 id="Usage"><a class="docs-heading-anchor" href="#Usage">Usage</a><a id="Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Usage" title="Permalink"></a></h3><p>Triggering sending of messages:</p><pre><code class="language-toml hljs">[global]
endpoint=&quot;endpoint.txt&quot;
[any]
conditions=[&quot;is_csv_file&quot;]
actions=[&quot;printtoslack&quot;, &quot;Found missing csv file !!&quot;]</code></pre><p>You can also specify the endpoint on the command line</p><pre><code class="nohighlight hljs">./datacurator.sif -r recipe.toml -e endpoint.txt</code></pre><h2 id="Owncloud"><a class="docs-heading-anchor" href="#Owncloud">Owncloud</a><a id="Owncloud-1"></a><a class="docs-heading-anchor-permalink" href="#Owncloud" title="Permalink"></a></h2><p>In your <a href="https://owncloud.com/">Owncloud account</a>, go to your profile settings, security, and click on &quot;Create new app passcode&quot;. Next, create a json file with credentials, let&#39;s call it <code>owncloud.json</code></p><pre><code class="language-json hljs">{&quot;token&quot;:&quot;yzzd&quot;,&quot;remote&quot;:&quot;https://remote.sever.com/remote.php/webdav/my/directory/&quot;,&quot;user&quot;:&quot;you&quot;}</code></pre><p>Where &quot;yzzd&quot; is the token you created. DO NOT share this file.</p><h3 id="Usage-2"><a class="docs-heading-anchor" href="#Usage-2">Usage</a><a class="docs-heading-anchor-permalink" href="#Usage-2" title="Permalink"></a></h3><pre><code class="language-toml hljs">[global]
owncloud_configuration=&quot;owncloud.json&quot;
[any]
conditions=[&quot;is_csv_file&quot;]
actions=[&quot;upload_to_owncloud&quot;]</code></pre><h2 id="SCP"><a class="docs-heading-anchor" href="#SCP">SCP</a><a id="SCP-1"></a><a class="docs-heading-anchor-permalink" href="#SCP" title="Permalink"></a></h2><p>DataCurator can send data remotely using SCP. For this to work, you need to have an SSH account with the remote server configured. You can find tutorials on how to do this here:</p><ul><li>https://learn.microsoft.com/en-us/windows/terminal/tutorials/ssh</li><li>https://linuxhandbook.com/ssh-basics/</li></ul><p>Make sure you have configured key-based access, password based access will NOT work.</p><p>Next, you need to creat a <code>json</code> file, let&#39;s call it <code>ssh.json</code> for now, that looks like the below:</p><pre><code class="language-json hljs">{&quot;port&quot;:&quot;22&quot;,&quot;remote&quot;:&quot;remote.server.name&quot;, &quot;path&quot;:&quot;/remote/directory&quot;,&quot;user&quot;:&quot;you&quot;}</code></pre><p>In the global configuration section, then reference this file</p><pre><code class="language-toml hljs">[global]
scp_configuration = &quot;ssh.json&quot;</code></pre><p>With this configured, DataCurator can now upload files that match your rules:</p><pre><code class="language-toml hljs">conditions=[&quot;is_csv_file&quot;]
actions=[&quot;upload_to_scp&quot;]</code></pre><h2 id="Triggering-remote-scripts"><a class="docs-heading-anchor" href="#Triggering-remote-scripts">Triggering remote scripts</a><a id="Triggering-remote-scripts-1"></a><a class="docs-heading-anchor-permalink" href="#Triggering-remote-scripts" title="Permalink"></a></h2><p>You can request DataCurator to submit a script to a remote server. This assumes you have SSH configured.</p><pre><code class="language-toml hljs">[global]

at_exit=[&quot;schedule_script&quot;, &quot;runscript.sh&quot;]</code></pre><p>where an example runscript is found <a href="https://github.com/bencardoen/DataCurator.jl/blob/main/scripts/example_slurm.sh">online</a>. At the end of the curation, DataCurator will then execute:</p><pre><code class="nohighlight hljs">scp runscript.sh you@remote.com:/your/dir/runscript.sh
ssh you@remote.com cd /your/dir/runscript.sh &amp;&amp; sbatch runscript.sh</code></pre><p>This first copies the script to the server, then calls the scheduler to schedule your script. This assumes that:</p><ul><li>You configured SSH</li><li>Your credentials are valid</li><li>You have a SLURM account</li></ul><h2 id="Remote-execution-of-DataCurator"><a class="docs-heading-anchor" href="#Remote-execution-of-DataCurator">Remote execution of DataCurator</a><a id="Remote-execution-of-DataCurator-1"></a><a class="docs-heading-anchor-permalink" href="#Remote-execution-of-DataCurator" title="Permalink"></a></h2><p>One way to remotely execute is to</p><ul><li>Transfer the Singularity image (or install remotely)</li><li>Execute</li></ul><p>For example:</p><pre><code class="language-bash hljs">scp datacurator.sif you@remote.com:/target/dir/datacurator.sif
ssh you@remote.com cd /target/dir &amp;&amp; ./datacurator.sif -r recipe.toml -e endpoint.txt &amp;</code></pre><p>A more interactive way would be</p><pre><code class="language-bash hljs">scp datacurator.sif you@remote.com:/target/dir/datacurator.sif
ssh you@remote.com
you@remote.com&gt;cd /target/dir
you@remote.com&gt;tmux
you@remote.com&gt;./datacurator.sif -r recipe.toml -e endpoint.txt &amp;
you@remote.com&gt;CTRL-B-D # logout but leave running</code></pre><p>On SLURM based schedulers it would be recommended to do</p><pre><code class="language-bash hljs">scp datacurator.sif you@remote.com:/target/dir/datacurator.sif
ssh you@remote.com
you@remote.com&gt;cd /target/dir
you@remote.com&gt;tmux
you@remote.com&gt;salloc --mem=64G .... ## Request resources from the cluster and execute in compute node
you@remote.com&gt;./datacurator.sif -r recipe.toml -e endpoint.txt &amp;
you@remote.com&gt;CTRL-B-D # logout but leave running</code></pre><h2 id="Singularity"><a class="docs-heading-anchor" href="#Singularity">Singularity</a><a id="Singularity-1"></a><a class="docs-heading-anchor-permalink" href="#Singularity" title="Permalink"></a></h2><p>If you use the Singularity image on a cluster, ensure you set the right file access.</p><pre><code class="language-bash hljs">export SINGULARITY_BINDPATH=&quot;/scratch/$USER, $SLURM_TMPDIR&quot;
singularity run datacurator.sif -r recipe.toml</code></pre><p>By default, only the /home/username directory can be read by Singularity.</p><h2 id="Notes"><a class="docs-heading-anchor" href="#Notes">Notes</a><a id="Notes-1"></a><a class="docs-heading-anchor-permalink" href="#Notes" title="Permalink"></a></h2><p>Please make sure the configurations of either service is ok before testing it in a recipe. Network based actions are brittle, and can hang. We try to use non-blocking actions where possible. Note that for large transfers it can be easier to move all data to the remote server, and do the curation there. Naturally, network speed, disk speed and so forth determine when this is the case.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="conditions.html">« Conditions and Actions for use in recipes</a><a class="docs-footer-nextpage" href="extending.html">Using Python or R code »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Monday 20 February 2023 15:08">Monday 20 February 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
